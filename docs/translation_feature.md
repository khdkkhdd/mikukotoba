# 번역 기능 명세서 (공통)

> JP Helper - 모든 사이트에서 공유하는 번역 기능의 사용자 관점 기능 명세
> 작성일: 2026-02-19

---

## 1. 기능 개요

일본어 텍스트를 한국어로 번역하고, 후리가나·로마자를 함께 표시하여 학습을 돕는 핵심 기능.

**핵심 가치**: "읽고 → 듣고(로마자) → 이해한다(번역)"의 학습 흐름을 웹 브라우징 중 자동으로 제공

**이 문서의 범위**: YouTube, Twitter(X), 일반 웹페이지 등 모든 사이트에서 공통으로 동작하는 번역·표시·설정 기능을 다룬다. 사이트별 고유 동작(자막 인터셉트, 타임라인 감시 등)은 각 사이트 명세서에서 별도로 기술한다.

---

## 2. 번역 결과 표시

### 2.1 표시 요소

번역된 일본어 텍스트에는 최대 4가지 정보가 함께 표시된다:

| 요소 | 설명 | 예시 |
|------|------|------|
| **후리가나** | 한자 위에 히라가나 읽기 표시 | <ruby>食<rt>た</rt></ruby>べる |
| **로마자** | 전체 문장의 로마자 표기 | taberu |
| **한국어 번역** | 번역된 한국어 문장 | 먹다 |
| **엔진 표시** | 번역에 사용된 엔진 이름 | `papago`, `claude` 등 |

- 이전에 번역한 적 있는 문장은 엔진 이름 뒤에 `cache`가 붙는다. (예: `papago cache`)
- 각 요소는 설정에서 개별적으로 ON/OFF할 수 있다.

### 2.2 재번역

번역 결과 옆에 **↻** 버튼이 표시된다. Papago 번역이 어색하거나 부정확할 때 이 버튼을 클릭하면:

- AI 엔진으로 다시 번역된다.
- 버튼이 회전 애니메이션으로 바뀌며 번역 중임을 표시한다.
- 완료되면 새 번역 결과로 교체된다.

### 2.3 로딩 상태

번역이 진행 중일 때는 스피너와 **"번역 중..."** 메시지가 표시된다.

---

## 3. 표시 방식

사이트별 핸들러에서 사용하는 공통 표시 방식은 3가지이다:

### 3.1 호버 팝업

마우스를 일본어 텍스트 위에 올리면 팝업이 나타난다.

- **내용**: 로마자 + 한국어 번역 + 엔진 표시 + 재번역 버튼
- **위치**: 마우스 커서 근처에 나타나며, 화면 밖으로 넘어가면 자동으로 위치 조정
- **유지**: 마우스가 원래 텍스트 또는 팝업 위에 있는 동안 유지
- **닫기**: 마우스를 벗어나면 잠시 후 사라짐, ESC 키로 즉시 닫기
- **텍스트 선택 가능**: 팝업 안의 번역문 등을 드래그로 선택·복사할 수 있으며, 선택 중에는 팝업이 사라지지 않는다.
- **스크롤 격리**: 팝업 안에서 스크롤해도 뒤쪽 페이지가 같이 스크롤되지 않는다.

### 3.2 인라인 번역

텍스트 바로 아래에 번역 블록이 삽입된다.

- **내용**: 후리가나가 붙은 원문 + 로마자 + 한국어 번역 + 엔진 표시 + 재번역 버튼
- 원래 페이지 흐름 안에 자연스럽게 삽입되어 스크롤하면서 읽을 수 있다.
- 한국어 번역은 기본적으로 **블러 처리**되어 숨겨진다. 클릭하면 보이고, 다시 클릭하면 숨겨진다. → 먼저 스스로 해석을 시도한 뒤 정답을 확인하는 학습 흐름.

### 3.3 후리가나 전용

원문의 한자 위에 후리가나만 표시한다. 번역문·로마자는 표시하지 않는다. 읽기 보조에만 집중하는 모드.

---

## 4. 번역 엔진

### 4.1 지원 엔진

| 엔진 | 설명 |
|------|------|
| **Papago** | 네이버 기계번역. 빠르고 비용이 낮다. |
| **Claude** | Anthropic AI. 맥락을 잘 이해한다. |
| **GPT** | OpenAI AI. 다양한 모델을 선택할 수 있다. |
| **Gemini** | Google AI. |

### 4.2 엔진 자동 선택

문장의 복잡도에 따라 엔진이 자동으로 선택된다:

- **단순한 문장** → Papago (빠르고 저렴)
- **복잡한 문장** (경어, 관용구, 긴 문장 등) → AI (더 정확)

어느 수준부터 AI를 사용할지는 **복잡도 슬라이더**로 조절할 수 있다 (→ 5.1절 참고).

### 4.3 엔진 폴백

선택된 엔진이 실패하면(네트워크 오류, API 제한 등) 자동으로 다른 엔진으로 재시도한다. 두 엔진 모두 사용 불가능한 경우에만 번역 실패가 표시된다.

---

## 5. 팝업 빠른 설정

확장 아이콘을 클릭하면 나타나는 팝업에서 자주 사용하는 설정을 빠르게 조절할 수 있다.

### 5.1 설정 항목

| 항목 | 설명 |
|------|------|
| **확장 프로그램 활성화** | 전체 ON/OFF 토글 |
| **YouTube 자막 번역** | YouTube 자막 번역 ON/OFF (별도 토글) |
| **웹페이지 모드** | 호버 번역 / 인라인 번역 / 전체 후리가나 / OFF 중 선택 |
| **학습 단계** | 입문 / 초급 / 중급 / 고급 |
| **표시 옵션** | 후리가나, 한국어 번역, 로마지 각각 ON/OFF |
| **복잡도 임계값** | Papago ↔ AI 사용 비율 슬라이더 (0~10) |
| **AI 번역 엔진** | 플랫폼(Claude / GPT / Gemini) 및 모델 선택 |
| **API 상태** | 각 엔진의 연결 상태 표시등 (초록=설정됨, 회색=미설정) |

### 5.2 학습 단계

학습 단계를 선택하면 표시 옵션이 자동으로 설정된다:

| 단계 | 후리가나 | 로마자 | 번역 |
|------|----------|--------|------|
| **입문** | ON | ON | ON |
| **초급** | ON | OFF | ON |
| **중급** | ON | OFF | ON |
| **고급** | ON | OFF | ON |

프리셋 적용 후에도 개별 옵션을 자유롭게 변경할 수 있다.

### 5.3 복잡도 슬라이더

Papago와 AI의 사용 비율을 조절하는 슬라이더:

- **0에 가까울수록**: 거의 모든 문장을 AI로 번역 (정확하지만 비용 높음)
- **10에 가까울수록**: 거의 모든 문장을 Papago로 번역 (빠르고 저렴)
- **기본값 5**: 약 35%의 문장이 AI로 번역됨

슬라이더 아래에 현재 선택된 AI 플랫폼 이름과 예상 AI 사용 비율(%)이 표시된다.

---

## 6. 설정 페이지

팝업의 **⚙** 버튼을 클릭하면 별도 탭에서 상세 설정 페이지가 열린다.

### 6.1 API 키 설정

번역 기능을 사용하려면 최소 1개 이상의 API 키를 입력해야 한다.

| 항목 | 설명 |
|------|------|
| Papago Client ID / Secret | Naver Cloud Platform 인증 정보 |
| Claude API Key | Anthropic API 키 |
| OpenAI API Key | OpenAI API 키 |
| Gemini API Key | Google AI Studio API 키 |

- 키는 **마스킹(●●●)** 상태로 표시되며, **"표시"** 버튼으로 토글 가능
- 각 엔진마다 **"연결 테스트"** 버튼이 있어 키의 유효성을 바로 확인할 수 있다.
- 테스트 결과는 성공/실패 메시지로 표시된다.
- **"키 저장"** 버튼을 눌러야 입력한 키가 저장된다.
- 키는 현재 기기에만 저장되며 다른 기기와 동기화되지 않는다.

### 6.2 표시 설정

#### YouTube 오버레이 / 호버 팝업용

| 항목 | 범위 | 기본값 |
|------|------|--------|
| 글꼴 크기 | 14~32px | 18px |
| 배경 투명도 | 0~100% | 80% |
| 원문 색상 | 컬러 피커 | 흰색 |
| 후리가나 색상 | 컬러 피커 | 회색 |
| 로마자 색상 | 컬러 피커 | 하늘색 |
| 번역 색상 | 컬러 피커 | 노란색 |

설정 변경 시 바로 아래의 **미리보기**에서 결과를 확인할 수 있다.

#### 인라인 / 후리가나 모드용

웹페이지 본문에 삽입되는 텍스트의 색상과 크기:

| 항목 | 범위 | 기본값 |
|------|------|--------|
| 번역 블록 크기 | 0.7~1.2em | 0.88em |
| 후리가나 크기 | 0.4~0.8em | 0.55em |
| 후리가나 색상 | 컬러 피커 | 회색 |
| 로마자 색상 | 컬러 피커 | 파란색 |
| 번역 색상 | 컬러 피커 | 짙은 회색 |

마찬가지로 **미리보기**가 함께 제공된다.

### 6.3 번역 설정

| 항목 | 설명 | 기본값 |
|------|------|--------|
| AI 번역 플랫폼 | Claude / GPT / Gemini 중 선택 | Claude |
| 모델 선택 | 플랫폼에 따라 선택 가능한 모델 목록이 바뀜 | — |
| 복잡도 임계값 | 0(모두 AI) ~ 10(모두 Papago) | 5 |
| 문맥 윈도우 크기 | AI 번역 시 참고할 이전 문장 수 (1~5) | 3 |

**고급 설정** (접힌 상태, 펼쳐야 보임):

| 항목 | 설명 | 기본값 |
|------|------|--------|
| 경어 감지 가중치 | 경어가 복잡도 판정에 미치는 영향 (0~5) | 3 |
| 문장 길이 가중치 | 긴 문장이 복잡도 판정에 미치는 영향 (0~3) | 1 |
| 관용구 감지 가중치 | 관용구가 복잡도 판정에 미치는 영향 (0~3) | 2 |

---

## 7. 용어집

### 7.1 내장 용어집

자주 사용되는 일본어 표현에 대해 미리 정의된 번역이 제공된다. 설정 페이지에서 펼쳐서 내용을 확인할 수 있다.

- **인사말**: `おはようございます` → `안녕하세요 (아침)` 등
- **문화 용어**: `先輩` → `선배`, `居酒屋` → `이자카야 (일본식 선술집)` 등
- **자주 오역되는 표현**: `やばい` → `대박/위험한`, `草` → `ㅋㅋㅋ` 등

내장 용어집은 수정할 수 없다.

### 7.2 커스텀 용어집

설정 페이지에서 사용자가 직접 용어를 관리할 수 있다:

- **추가**: 일본어, 한국어, 메모(선택)를 입력하고 "추가" 버튼 클릭
- **삭제**: 각 항목 옆의 ✕ 버튼 클릭
- **CSV 가져오기**: "CSV 가져오기" 버튼 → 파일 선택 → 일괄 추가
- **CSV 내보내기**: "CSV 내보내기" 버튼 → `jp-helper-glossary.csv` 파일 다운로드

커스텀 용어집에 등록된 표현이 번역 대상 문장에 포함되어 있으면, AI 번역 시 해당 용어의 선호 번역이 참고된다.

---

## 8. 캐시 관리

이전에 번역한 문장은 자동으로 저장되어, 같은 문장을 다시 만나면 즉시 결과가 표시된다.

설정 페이지에서:

- 현재 캐시된 항목 수와 예상 크기(KB)를 확인할 수 있다.
- **"캐시 전체 삭제"** 버튼으로 모든 캐시를 삭제할 수 있다 (확인 다이얼로그 표시).
- 재번역(↻)을 하면 해당 문장의 캐시만 갱신된다.

오래된 캐시는 자동으로 정리된다.

---

## 9. 사용 통계

설정 페이지에서 번역 사용 현황을 확인할 수 있다.

### 9.1 표시 항목

- 총 번역 수
- 엔진별 사용 횟수 (Papago / Claude / OpenAI / Gemini)
- 캐시 히트 수 (캐시에서 바로 가져온 횟수)

### 9.2 사용 비율 차트

엔진별 사용 비율이 색상 막대 그래프로 시각화된다. 각 엔진은 서로 다른 색상으로 구분된다.

---

## 10. 키보드 단축키

| 단축키 | 동작 |
|--------|------|
| `Alt+J` | 확장 프로그램 전체 ON/OFF |
| `Alt+F` | 후리가나 표시 토글 |
| `Alt+T` | 번역 표시 토글 |
| `Alt+R` | 로마지 표시 토글 |

단축키는 `chrome://extensions/shortcuts`에서 변경할 수 있다.

---

## 11. 설정 반영

- 팝업이나 설정 페이지에서 설정을 변경하면 현재 열린 **모든 탭**에 즉시 반영된다.
- 표시 설정, 모드, 학습 단계 등은 같은 Google 계정의 다른 기기에서도 동기화된다.
- API 키는 보안상 현재 기기에만 저장된다 (기기별로 따로 입력 필요).

---

## 12. 제한사항

| 항목 | 설명 |
|------|------|
| API 키 필수 | 최소 1개 이상의 번역 엔진 API 키가 있어야 번역 가능 |
| 한국어 전용 | 번역 대상 언어는 한국어만 지원 |
| 일본어 전용 | 원문 언어는 일본어만 지원 |
| 번역 수정 불가 | 번역 결과를 사용자가 직접 수정하는 UI가 없음 (재번역만 가능) |
| 학습 단계 프리셋 단조 | 초급·중급·고급의 프리셋이 사실상 동일 |
| 오프라인 미지원 | 인터넷 연결이 필요 |

---

## 13. To-Do: 개선 제안

### 높은 우선순위

| 기능 | 설명 | 근거 |
|------|------|------|
| **학습 단계별 프리셋 차별화** | 중급: 후리가나 OFF + 번역 ON, 고급: 모두 OFF + 스포일러 등 단계별로 다른 학습 경험 | 현재 초급·중급·고급이 동일하여 선택하는 의미가 없음 |
| **번역 수정 기능** | 번역 결과를 클릭하여 직접 고치고, 이후 같은 표현에 수정 내용이 반영되는 기능 | 재번역만으로는 원하는 번역을 얻기 어려운 경우가 있음 |

### 중간 우선순위

| 기능 | 설명 | 근거 |
|------|------|------|
| **단어 클릭 상세 보기** | 번역 결과에서 개별 단어를 클릭하면 읽기, 품사, 뜻이 팝업으로 표시 | 문장 안에서 모르는 단어를 바로 확인 |
| **번역 품질 피드백** | 번역 결과에 좋아요/싫어요 버튼 | 어떤 엔진이 더 나은지 파악하는 데 도움 |
| **다국어 번역** | 한국어 외에 영어, 중국어 등 지원 | 더 넓은 사용자층 |
| **복잡도 표시** | 왜 이 문장에 AI가 사용되었는지(경어, 관용구 등) 표시 | 학습자가 문장의 난이도를 이해하는 데 도움 |

### 낮은 우선순위

| 기능 | 설명 | 근거 |
|------|------|------|
| **번역 비교** | Papago와 AI 결과를 나란히 비교 | 엔진별 차이를 직접 확인 |
| **번역 이력** | 과거 번역한 문장을 시간순으로 열람 | 복습 및 학습 기록 |
| **비용 추적** | API 호출 비용을 엔진별로 추정·표시 | 사용량 관리 |
