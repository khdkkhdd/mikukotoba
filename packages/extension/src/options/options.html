<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ミク言葉 - 설정</title>
  <link rel="stylesheet" href="options.css">
</head>
<body>
  <div class="options-page">
    <header class="page-header">
      <h1><span class="logo-badge">JP</span> Helper 설정</h1>
    </header>

    <!-- API Keys Section -->
    <section class="card" id="apiSection">
      <h2>API 키 설정</h2>
      <p class="help-text">번역 기능을 사용하려면 API 키를 입력해주세요. 키는 이 기기에만 저장됩니다.</p>

      <details class="api-provider" open>
        <summary class="api-provider-summary">
          <span class="provider-icon provider-papago"></span> Papago
        </summary>
        <div class="api-provider-content">
          <div class="form-group">
            <label>Client ID</label>
            <div class="input-row">
              <input type="password" id="papagoClientId" placeholder="Naver Cloud Platform Client ID">
              <button id="togglePapagoId" class="btn-small">표시</button>
            </div>
          </div>
          <div class="form-group">
            <label>Client Secret</label>
            <div class="input-row">
              <input type="password" id="papagoClientSecret" placeholder="Naver Cloud Platform Client Secret">
              <button id="togglePapagoSecret" class="btn-small">표시</button>
            </div>
          </div>
          <button id="testPapago" class="btn">연결 테스트</button>
          <span id="papagoTestResult" class="test-result"></span>
        </div>
      </details>

      <details class="api-provider">
        <summary class="api-provider-summary">
          <span class="provider-icon provider-claude"></span> Claude
        </summary>
        <div class="api-provider-content">
          <div class="form-group">
            <label>API Key</label>
            <div class="input-row">
              <input type="password" id="claudeApiKey" placeholder="Anthropic API Key (sk-ant-...)">
              <button id="toggleClaudeKey" class="btn-small">표시</button>
            </div>
          </div>
          <button id="testClaude" class="btn">연결 테스트</button>
          <span id="claudeTestResult" class="test-result"></span>
        </div>
      </details>

      <details class="api-provider">
        <summary class="api-provider-summary">
          <span class="provider-icon provider-openai"></span> OpenAI
        </summary>
        <div class="api-provider-content">
          <div class="form-group">
            <label>API Key</label>
            <div class="input-row">
              <input type="password" id="openaiApiKey" placeholder="OpenAI API Key (sk-...)">
              <button id="toggleOpenaiKey" class="btn-small">표시</button>
            </div>
          </div>
          <button id="testOpenai" class="btn">연결 테스트</button>
          <span id="openaiTestResult" class="test-result"></span>
        </div>
      </details>

      <details class="api-provider">
        <summary class="api-provider-summary">
          <span class="provider-icon provider-gemini"></span> Gemini
        </summary>
        <div class="api-provider-content">
          <div class="form-group">
            <label>API Key</label>
            <div class="input-row">
              <input type="password" id="geminiApiKey" placeholder="Google AI Studio API Key">
              <button id="toggleGeminiKey" class="btn-small">표시</button>
            </div>
          </div>
          <button id="testGemini" class="btn">연결 테스트</button>
          <span id="geminiTestResult" class="test-result"></span>
        </div>
      </details>

      <button id="saveApiKeys" class="btn btn-primary mt-card">키 저장</button>
    </section>

    <!-- Display Settings -->
    <section class="card">
      <h2>표시 설정</h2>

      <div class="form-group">
        <label>글꼴 크기: <span id="fontSizeValue">18</span>px</label>
        <input type="range" id="fontSize" min="14" max="32" step="1" value="18">
      </div>

      <div class="form-group">
        <label>배경 투명도: <span id="opacityValue">80</span>%</label>
        <input type="range" id="backgroundOpacity" min="0" max="100" step="5" value="80">
      </div>

      <h3>YouTube 오버레이 / 호버 팝업</h3>
      <div class="color-grid">
        <div class="form-group">
          <label>원문</label>
          <div class="color-input-row">
            <input type="color" id="colorOriginal" value="#FFFFFF">
            <span class="color-hex" data-for="colorOriginal">#FFFFFF</span>
          </div>
        </div>
        <div class="form-group">
          <label>후리가나</label>
          <div class="color-input-row">
            <input type="color" id="colorFurigana" value="#B0B0B0">
            <span class="color-hex" data-for="colorFurigana">#B0B0B0</span>
          </div>
        </div>
        <div class="form-group">
          <label>로마지</label>
          <div class="color-input-row">
            <input type="color" id="colorRomaji" value="#7CB9E8">
            <span class="color-hex" data-for="colorRomaji">#7CB9E8</span>
          </div>
        </div>
        <div class="form-group">
          <label>번역</label>
          <div class="color-input-row">
            <input type="color" id="colorTranslation" value="#F0E68C">
            <span class="color-hex" data-for="colorTranslation">#F0E68C</span>
          </div>
        </div>
      </div>

      <!-- YouTube Preview -->
      <div class="preview-box" id="preview">
        <div class="preview-original">
          <ruby>食<rt>た</rt></ruby>べに<ruby>行<rt>い</rt></ruby>きました
        </div>
        <div class="preview-romaji">tabe ni ikimashita</div>
        <div class="preview-translation">먹으러 갔습니다</div>
      </div>

      <h3 class="mt-card">인라인 / 후리가나 모드</h3>
      <p class="help-text">웹페이지 본문에 삽입되는 텍스트 색상 및 크기</p>

      <div class="form-group">
        <label>번역 블록 크기: <span id="inlineFontScaleValue">0.88</span>em</label>
        <input type="range" id="inlineFontScale" min="0.7" max="1.2" step="0.02" value="0.88">
      </div>
      <div class="form-group">
        <label>후리가나 크기: <span id="inlineFuriganaScaleValue">0.55</span>em</label>
        <input type="range" id="inlineFuriganaScale" min="0.4" max="0.8" step="0.05" value="0.55">
      </div>

      <div class="color-grid">
        <div class="form-group">
          <label>후리가나</label>
          <div class="color-input-row">
            <input type="color" id="inlineColorFurigana" value="#888888">
            <span class="color-hex" data-for="inlineColorFurigana">#888888</span>
          </div>
        </div>
        <div class="form-group">
          <label>로마지</label>
          <div class="color-input-row">
            <input type="color" id="inlineColorRomaji" value="#4A7DFF">
            <span class="color-hex" data-for="inlineColorRomaji">#4A7DFF</span>
          </div>
        </div>
        <div class="form-group">
          <label>번역</label>
          <div class="color-input-row">
            <input type="color" id="inlineColorTranslation" value="#555555">
            <span class="color-hex" data-for="inlineColorTranslation">#555555</span>
          </div>
        </div>
      </div>

      <!-- Inline Preview -->
      <div class="preview-box preview-box-inline" id="previewInline">
        <div class="preview-inline-original">
          <ruby>食<rt>た</rt></ruby>べに<ruby>行<rt>い</rt></ruby>きました
        </div>
        <div class="preview-inline-romaji">tabe ni ikimashita</div>
        <div class="preview-inline-translation">먹으러 갔습니다</div>
      </div>
    </section>

    <!-- Translation Settings -->
    <section class="card">
      <h2>번역 설정</h2>

      <div class="form-group">
        <label>AI 번역 플랫폼</label>
        <select id="llmPlatform" class="select-full">
          <option value="claude">Claude (Anthropic)</option>
          <option value="openai">GPT (OpenAI)</option>
          <option value="gemini">Gemini (Google)</option>
        </select>
      </div>

      <div class="form-group">
        <label>모델 선택</label>
        <select id="llmModel" class="select-full"></select>
      </div>

      <div class="form-group">
        <label>복잡도 임계값: <span id="thresholdValue">5</span></label>
        <p class="help-text">낮을수록 AI 사용 비율이 높아집니다 (더 정확하지만 비용 증가)</p>
        <input type="range" id="complexityThreshold" min="0" max="10" step="1" value="5">
        <div class="range-labels">
          <span>0 (모두 AI)</span>
          <span>10 (모두 Papago)</span>
        </div>
      </div>

      <div class="form-group">
        <label>문맥 윈도우 크기: <span id="contextValue">3</span></label>
        <p class="help-text">AI 번역 시 참고할 이전 문장 수</p>
        <input type="range" id="contextWindowSize" min="1" max="5" step="1" value="3">
      </div>

      <details class="advanced-settings">
        <summary>고급 설정 (복잡도 가중치)</summary>
        <div class="form-group">
          <label>경어 감지 가중치: <span id="keigoValue">3</span></label>
          <input type="range" id="keigoWeight" min="0" max="5" step="1" value="3">
        </div>
        <div class="form-group">
          <label>문장 길이 가중치: <span id="lengthValue">1</span></label>
          <input type="range" id="lengthWeight" min="0" max="3" step="1" value="1">
        </div>
        <div class="form-group">
          <label>관용구 감지 가중치: <span id="idiomValue">2</span></label>
          <input type="range" id="idiomWeight" min="0" max="3" step="1" value="2">
        </div>
      </details>
    </section>

    <!-- Glossary -->
    <section class="card">
      <h2>용어집</h2>

      <details>
        <summary>내장 용어집 보기</summary>
        <div id="builtInGlossary" class="glossary-list"></div>
      </details>

      <h3 class="mt-card">커스텀 용어집</h3>

      <div class="glossary-add">
        <input type="text" id="glossaryJp" placeholder="일본어">
        <input type="text" id="glossaryKo" placeholder="한국어">
        <input type="text" id="glossaryNote" placeholder="메모 (선택)">
        <button id="addGlossary" class="btn btn-small">추가</button>
      </div>

      <div id="customGlossary" class="glossary-list"></div>

      <div class="glossary-actions">
        <button id="importGlossary" class="btn btn-small">CSV 가져오기</button>
        <button id="exportGlossary" class="btn btn-small">CSV 내보내기</button>
        <input type="file" id="glossaryFile" accept=".csv" style="display: none;">
      </div>
    </section>

    <!-- Google Drive Sync -->
    <section class="card" id="syncSection">
      <h2>Google Drive 동기화</h2>
      <p class="help-text">단어장 데이터를 Google Drive에 동기화하여 기기 간 공유할 수 있습니다.</p>

      <div class="form-group">
        <label>OAuth Client ID</label>
        <div class="input-row">
          <input type="password" id="driveClientId" placeholder="GCP OAuth 2.0 Client ID">
          <button id="toggleDriveClientId" class="btn-small">표시</button>
          <button id="saveDriveClientId" class="btn-small btn-primary">저장</button>
        </div>
        <p class="help-text">Google Cloud Console에서 발급한 OAuth 2.0 클라이언트 ID를 입력하세요.</p>
      </div>

      <div class="form-group">
        <label>Redirect URI <span class="help-text">(GCP 승인된 리디렉션 URI에 추가)</span></label>
        <div class="input-row">
          <input type="text" id="driveRedirectUri" readonly>
          <button id="copyRedirectUri" class="btn-small">복사</button>
        </div>
      </div>

      <div id="driveNotConnected">
        <button id="driveLoginBtn" class="btn btn-primary">Google 계정 연결</button>
      </div>

      <div id="driveConnected" style="display: none;">
        <div class="sync-status-row">
          <div class="sync-info">
            <span class="sync-email" id="driveEmail"></span>
            <span class="sync-time" id="lastSyncTime">마지막 동기화: -</span>
          </div>
          <div class="sync-actions">
            <button id="syncNowBtn" class="btn btn-small">지금 동기화</button>
            <button id="driveLogoutBtn" class="btn btn-small">연결 해제</button>
          </div>
        </div>
      </div>

      <div id="syncResultMsg" class="sync-result"></div>
    </section>

    <!-- Cache Management -->
    <section class="card">
      <h2>캐시 관리</h2>
      <p>캐시된 항목: <strong id="cacheCount">0</strong>개 (약 <span id="cacheSize">0</span>KB)</p>
      <button id="clearCache" class="btn btn-danger">캐시 전체 삭제</button>
    </section>

    <!-- Usage Statistics -->
    <section class="card">
      <h2>사용 통계</h2>

      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-value" id="totalTranslations">0</div>
          <div class="stat-label">총 번역 수</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="papagoCount">0</div>
          <div class="stat-label">Papago</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="claudeCount">0</div>
          <div class="stat-label">Claude</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="openaiCount">0</div>
          <div class="stat-label">OpenAI</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="geminiCount">0</div>
          <div class="stat-label">Gemini</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="cacheHits">0</div>
          <div class="stat-label">캐시 히트</div>
        </div>
      </div>

      <div class="usage-bar" id="usageBar">
        <div class="usage-papago" id="usagePapago" style="width: 25%"></div>
        <div class="usage-claude" id="usageClaude" style="width: 25%"></div>
        <div class="usage-openai" id="usageOpenai" style="width: 25%"></div>
        <div class="usage-gemini" id="usageGemini" style="width: 25%"></div>
      </div>
      <div class="usage-legend">
        <span class="legend-papago">Papago</span>
        <span class="legend-claude">Claude</span>
        <span class="legend-openai">OpenAI</span>
        <span class="legend-gemini">Gemini</span>
      </div>
    </section>

    <!-- Keyboard Shortcuts -->
    <section class="card">
      <h2>키보드 단축키</h2>
      <table class="shortcut-table">
        <tr>
          <td><kbd class="key-win">Alt+M</kbd><kbd class="key-mac">⌥M</kbd></td>
          <td>확장 프로그램 ON/OFF</td>
        </tr>
        <tr>
          <td><kbd class="key-win">Alt+F</kbd><kbd class="key-mac">⌥F</kbd></td>
          <td>후리가나 토글</td>
        </tr>
        <tr>
          <td><kbd class="key-win">Alt+T</kbd><kbd class="key-mac">⌥T</kbd></td>
          <td>번역 표시 토글</td>
        </tr>
        <tr>
          <td><kbd class="key-win">Alt+R</kbd><kbd class="key-mac">⌥R</kbd></td>
          <td>로마지 토글</td>
        </tr>
        <tr>
          <td><span class="key-unset">미지정</span></td>
          <td>웹페이지 모드 전환</td>
        </tr>
      </table>
      <p class="help-text">단축키 변경: chrome://extensions/shortcuts</p>
    </section>
  </div>

  <script type="module" src="options.ts"></script>
</body>
</html>
